use v6;
use Test;
use _007::Test;

# --- from t/builtins/methods.t
{
    my $program = q:to/./;
        macro so_hygienic() {
            my x = "yay, clean!";
            return quasi {
                say(x);
            };
        }

        macro so_unhygienic() {
            my x = "something is implemented wrong";
            return quasi {
                say(x)
            }.detach();
        }

        my x = "that's gross!";
        so_hygienic();    # yay, clean!
        so_unhygienic();  # that's gross!
        .

    outputs $program, "yay, clean!\nthat's gross!\n",
        "detaching a qtree makes its identifiers unhygienic (#62)";
}

# --- from t/features/quasi.t
{
    my $program = q:to/./;
        macro moo() {
            my y = "right";
            return quasi {
                say(y);
                {
                    my y = "wrong";
                }
                say(y);
            };
        };

        moo();
        .

    outputs $program, "right\nright\n", "an injectile gets the quasi's outer scope";
}

done-testing;

