#!/usr/bin/env perl6
use v6;
use _007;

constant %BACKENDS = hash
    "default" => { $^runtime.run($^ast) },
    "runtime" => { $^runtime.run($^ast) },
;

sub run_007($program, Str $backend) {
    die "Unknown backend '$backend'"
        unless %BACKENDS{$backend} :exists;

    my $runtime = _007.runtime;
    my $ast = _007.parser(:$runtime).parse($program);
    %BACKENDS{$backend}($ast, $runtime);
}

multi MAIN($path, Str :$backend = "default") {
    run_007(slurp($path), $backend);
}

multi MAIN(Str :e($program)!, Str :$backend = "default") {
    run_007($program, $backend);
}
